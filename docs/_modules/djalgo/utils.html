<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>djalgo.utils &#8212; Djalgo 0.1-alpha documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=737112c1"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for djalgo.utils</h1><div class="highlight"><pre>
<div class="viewcode-block" id="round_to_list">
<a class="viewcode-back" href="../../api.html#djalgo.utils.round_to_list">[docs]</a>
<span></span><span class="k">def</span> <span class="nf">round_to_list</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rounds the given value to the nearest value in the scale list.</span>

<span class="sd">    Args:</span>
<span class="sd">        value (float): The value to be rounded.</span>
<span class="sd">        scale (list): A list of values to round to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The value from the scale list that is closest to the given value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">value</span><span class="p">))</span></div>


<div class="viewcode-block" id="get_octave">
<a class="viewcode-back" href="../../api.html#djalgo.utils.get_octave">[docs]</a>
<span class="k">def</span> <span class="nf">get_octave</span><span class="p">(</span><span class="n">midi_note</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">midi_note</span> <span class="o">//</span> <span class="mi">12</span> <span class="o">-</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="get_sharp">
<a class="viewcode-back" href="../../api.html#djalgo.utils.get_sharp">[docs]</a>
<span class="k">def</span> <span class="nf">get_sharp</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="n">dict_flat</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;D-&#39;</span><span class="p">:</span> <span class="s1">&#39;C#&#39;</span><span class="p">,</span> <span class="s1">&#39;E-&#39;</span><span class="p">:</span> <span class="s1">&#39;D#&#39;</span><span class="p">,</span> <span class="s1">&#39;G-&#39;</span><span class="p">:</span> <span class="s1">&#39;F#&#39;</span><span class="p">,</span> <span class="s1">&#39;A-&#39;</span><span class="p">:</span> <span class="s1">&#39;G#&#39;</span><span class="p">,</span> <span class="s1">&#39;B-&#39;</span><span class="p">:</span> <span class="s1">&#39;A#&#39;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">dict_flat</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">dict_flat</span><span class="p">[</span><span class="n">string</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">string</span></div>


<div class="viewcode-block" id="get_degree_from_pitch">
<a class="viewcode-back" href="../../api.html#djalgo.utils.get_degree_from_pitch">[docs]</a>
<span class="k">def</span> <span class="nf">get_degree_from_pitch</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">scale_list</span><span class="p">,</span> <span class="n">tonic_pitch</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="n">cde_to_midi</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tonic_pitch</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">tonic_pitch</span> <span class="o">=</span> <span class="n">cde_to_midi</span><span class="p">(</span><span class="n">tonic_pitch</span><span class="p">)</span> 

    <span class="n">tonic_index</span> <span class="o">=</span> <span class="n">scale_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tonic_pitch</span><span class="p">)</span>

    <span class="c1"># If the pitch is in the scale_type</span>
    <span class="k">if</span> <span class="n">pitch</span> <span class="ow">in</span> <span class="n">scale_list</span><span class="p">:</span>
        <span class="c1"># Find its index and compute the degree</span>
        <span class="n">pitch_index</span> <span class="o">=</span> <span class="n">scale_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="n">pitch_index</span> <span class="o">-</span> <span class="n">tonic_index</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If the pitch is not in the scale_type, find the two pitches it falls between</span>
        <span class="n">upper_pitch</span> <span class="o">=</span> <span class="n">round_to_list</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">scale_list</span><span class="p">)</span>
        <span class="n">upper_index</span> <span class="o">=</span> <span class="n">scale_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">upper_pitch</span><span class="p">)</span>
        <span class="n">lower_index</span> <span class="o">=</span> <span class="n">upper_index</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">upper_index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">upper_index</span>
        <span class="n">lower_pitch</span> <span class="o">=</span> <span class="n">scale_list</span><span class="p">[</span><span class="n">lower_index</span><span class="p">]</span>

        <span class="c1"># Compute the degree as the weighted average of the degrees of the two pitches</span>
        <span class="n">distance_to_upper</span> <span class="o">=</span> <span class="n">upper_pitch</span> <span class="o">-</span> <span class="n">pitch</span>
        <span class="n">distance_to_lower</span> <span class="o">=</span> <span class="n">pitch</span> <span class="o">-</span> <span class="n">lower_pitch</span>
        <span class="n">upper_weight</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">distance_to_upper</span> <span class="o">/</span> <span class="p">(</span><span class="n">distance_to_upper</span> <span class="o">+</span> <span class="n">distance_to_lower</span><span class="p">)</span>
        <span class="n">lower_weight</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">distance_to_lower</span> <span class="o">/</span> <span class="p">(</span><span class="n">distance_to_upper</span> <span class="o">+</span> <span class="n">distance_to_lower</span><span class="p">)</span>
        <span class="n">upper_degree</span> <span class="o">=</span> <span class="n">upper_index</span> <span class="o">-</span> <span class="n">tonic_index</span>
        <span class="n">lower_degree</span> <span class="o">=</span> <span class="n">lower_index</span> <span class="o">-</span> <span class="n">tonic_index</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="n">upper_degree</span> <span class="o">*</span> <span class="n">upper_weight</span> <span class="o">+</span> <span class="n">lower_degree</span> <span class="o">*</span> <span class="n">lower_weight</span>

    <span class="k">return</span> <span class="n">degree</span></div>


<div class="viewcode-block" id="get_pitch_from_degree">
<a class="viewcode-back" href="../../api.html#djalgo.utils.get_pitch_from_degree">[docs]</a>
<span class="k">def</span> <span class="nf">get_pitch_from_degree</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span> <span class="n">scale_list</span><span class="p">,</span> <span class="n">tonic_pitch</span><span class="p">):</span>
    <span class="n">tonic_index</span> <span class="o">=</span> <span class="n">scale_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tonic_pitch</span><span class="p">)</span>
    <span class="n">pitch_index</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">tonic_index</span> <span class="o">+</span> <span class="n">degree</span><span class="p">)</span>  <span class="c1"># round to nearest integer</span>

    <span class="c1"># If the degree is within the scale</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">pitch_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">scale_list</span><span class="p">):</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="n">scale_list</span><span class="p">[</span><span class="n">pitch_index</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If the degree is not within the scale, find the two pitches it falls between</span>
        <span class="n">lower_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">pitch_index</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">scale_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">upper_index</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scale_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">pitch_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">lower_pitch</span> <span class="o">=</span> <span class="n">scale_list</span><span class="p">[</span><span class="n">lower_index</span><span class="p">]</span>
        <span class="n">upper_pitch</span> <span class="o">=</span> <span class="n">scale_list</span><span class="p">[</span><span class="n">upper_index</span><span class="p">]</span>

        <span class="c1"># Compute the pitch as the weighted average of the two pitches</span>
        <span class="n">distance_to_upper</span> <span class="o">=</span> <span class="n">upper_index</span> <span class="o">-</span> <span class="n">pitch_index</span>
        <span class="n">distance_to_lower</span> <span class="o">=</span> <span class="n">pitch_index</span> <span class="o">-</span> <span class="n">lower_index</span>
        <span class="n">upper_weight</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">distance_to_upper</span> <span class="o">/</span> <span class="p">(</span><span class="n">distance_to_upper</span> <span class="o">+</span> <span class="n">distance_to_lower</span><span class="p">)</span>
        <span class="n">lower_weight</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">distance_to_lower</span> <span class="o">/</span> <span class="p">(</span><span class="n">distance_to_upper</span> <span class="o">+</span> <span class="n">distance_to_lower</span><span class="p">)</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="n">upper_pitch</span> <span class="o">*</span> <span class="n">upper_weight</span> <span class="o">+</span> <span class="n">lower_pitch</span> <span class="o">*</span> <span class="n">lower_weight</span>

    <span class="k">return</span> <span class="n">pitch</span></div>


<div class="viewcode-block" id="set_offsets_according_to_durations">
<a class="viewcode-back" href="../../api.html#djalgo.utils.set_offsets_according_to_durations">[docs]</a>
<span class="k">def</span> <span class="nf">set_offsets_according_to_durations</span><span class="p">(</span><span class="n">notes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusts the offsets of the notes based on their durations.</span>

<span class="sd">    Args:</span>
<span class="sd">        notes (list): A list of tuples, where each tuple contains a note (pitch),</span>
<span class="sd">                      a duration (quarterLength), and an offset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: The list of notes with adjusted offsets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">adjusted_notes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_offset</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
        <span class="n">adjusted_notes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pitch</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">current_offset</span><span class="p">))</span>
        <span class="n">current_offset</span> <span class="o">+=</span> <span class="n">duration</span>

    <span class="k">return</span> <span class="n">adjusted_notes</span></div>


<div class="viewcode-block" id="fill_gaps_with_rests">
<a class="viewcode-back" href="../../api.html#djalgo.utils.fill_gaps_with_rests">[docs]</a>
<span class="k">def</span> <span class="nf">fill_gaps_with_rests</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">parent_offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze a sorted list of notes (each note is a (pitch, duration, offset) tuple)</span>
<span class="sd">    and insert rests (None, duration, offset) to fill gaps between notes. Notes are</span>
<span class="sd">    sorted by offset before processing to ensure accurate gap detection and filling.</span>

<span class="sd">    Args:</span>
<span class="sd">        notes (list): The list of notes to be processed, not necessarily sorted.</span>
<span class="sd">        parent_offset (float): The offset to consider from the parent sequence, used in recursion.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: The modified list with gaps filled with rests, ensuring continuity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sort notes by offset to ensure correct processing order</span>
    <span class="n">notes_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">last_offset</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Keep track of the offset after the last note or rest</span>
    <span class="n">filled_notes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes_sorted</span><span class="p">:</span>
        <span class="n">pitch</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">note</span>
        <span class="n">current_offset</span> <span class="o">=</span> <span class="n">parent_offset</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="n">current_offset</span> <span class="o">&gt;</span> <span class="n">last_offset</span><span class="p">:</span>
            <span class="c1"># There is a gap that needs to be filled with a rest</span>
            <span class="n">gap_duration</span> <span class="o">=</span> <span class="n">current_offset</span> <span class="o">-</span> <span class="n">last_offset</span>
            <span class="n">rest_to_insert</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">gap_duration</span><span class="p">,</span> <span class="n">last_offset</span> <span class="o">-</span> <span class="n">parent_offset</span><span class="p">)</span>
            <span class="n">filled_notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rest_to_insert</span><span class="p">)</span>  <span class="c1"># Insert the rest to fill the gap</span>

        <span class="n">filled_notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
        <span class="n">last_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">last_offset</span><span class="p">,</span> <span class="n">current_offset</span> <span class="o">+</span> <span class="n">duration</span><span class="p">)</span>  <span class="c1"># Update last offset for the next iteration</span>

    <span class="k">return</span> <span class="n">filled_notes</span></div>



<div class="viewcode-block" id="adjust_note_durations_to_prevent_overlaps">
<a class="viewcode-back" href="../../api.html#djalgo.utils.adjust_note_durations_to_prevent_overlaps">[docs]</a>
<span class="k">def</span> <span class="nf">adjust_note_durations_to_prevent_overlaps</span><span class="p">(</span><span class="n">notes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjust the durations of notes in a list (each note is a (pitch, duration, offset) tuple)</span>
<span class="sd">    to prevent overlaps, while keeping their offsets intact.</span>

<span class="sd">    Args:</span>
<span class="sd">        notes (list): The list of notes to be adjusted.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: The modified list with adjusted note durations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure the list is sorted by offset</span>
    <span class="n">notes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">note</span><span class="p">:</span> <span class="n">note</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># Loop through all notes except the last one</span>
        <span class="n">current_note</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">next_note</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Calculate the current end of the note</span>
        <span class="n">current_note_end</span> <span class="o">=</span> <span class="n">current_note</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">current_note</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># If the current note ends after the next note starts, adjust its duration</span>
        <span class="k">if</span> <span class="n">current_note_end</span> <span class="o">&gt;</span> <span class="n">next_note</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="c1"># Adjust duration to avoid overlap</span>
            <span class="n">new_duration</span> <span class="o">=</span> <span class="n">next_note</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_note</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_note</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_duration</span><span class="p">,</span> <span class="n">current_note</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">notes</span></div>


<div class="viewcode-block" id="repair_notes">
<a class="viewcode-back" href="../../api.html#djalgo.utils.repair_notes">[docs]</a>
<span class="k">def</span> <span class="nf">repair_notes</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply the fill_gaps_with_rests and adjust_note_durations_to_prevent_overlaps functions to a stream.</span>

<span class="sd">    Args:</span>
<span class="sd">        s (stream.Stream): The music21 stream to be processed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        stream.Stream: The modified stream with gaps filled and note durations adjusted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">adjust_note_durations_to_prevent_overlaps</span><span class="p">(</span><span class="n">fill_gaps_with_rests</span><span class="p">(</span><span class="n">s</span><span class="p">))</span></div>


<div class="viewcode-block" id="cde_to_midi">
<a class="viewcode-back" href="../../api.html#djalgo.utils.cde_to_midi">[docs]</a>
<span class="k">def</span> <span class="nf">cde_to_midi</span><span class="p">(</span><span class="n">pitch</span><span class="p">):</span>
    <span class="c1"># Mapping of note names to MIDI numbers with sharps</span>
    <span class="n">pitches</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;C#&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;D#&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;F#&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;G#&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;A#&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]</span>
    <span class="n">flat_to_sharp</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Db&#39;</span><span class="p">:</span> <span class="s1">&#39;C#&#39;</span><span class="p">,</span> <span class="s1">&#39;Eb&#39;</span><span class="p">:</span> <span class="s1">&#39;D#&#39;</span><span class="p">,</span> <span class="s1">&#39;Gb&#39;</span><span class="p">:</span> <span class="s1">&#39;F#&#39;</span><span class="p">,</span> <span class="s1">&#39;Ab&#39;</span><span class="p">:</span> <span class="s1">&#39;G#&#39;</span><span class="p">,</span> <span class="s1">&#39;Bb&#39;</span><span class="p">:</span> <span class="s1">&#39;A#&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Cb&#39;</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span>  <span class="c1"># Special handling for &#39;Cb&#39;, converting it directly to &#39;B&#39;</span>
    <span class="p">}</span>

    <span class="n">octave</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Default octave if not specified in the pitch string</span>

    <span class="c1"># Check and convert flat notes to sharp notes</span>
    <span class="k">if</span> <span class="s1">&#39;b&#39;</span> <span class="ow">in</span> <span class="n">pitch</span><span class="p">:</span>
        <span class="n">note</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Exclude the octave number if present</span>
        <span class="k">if</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">flat_to_sharp</span><span class="p">:</span>
            <span class="n">pitch</span> <span class="o">=</span> <span class="n">flat_to_sharp</span><span class="p">[</span><span class="n">note</span><span class="p">]</span> <span class="o">+</span> <span class="n">pitch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Append the octave number back if it was present</span>

    <span class="c1"># Extract the note (with sharp) and octave from the pitch</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">pitch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
        <span class="n">note</span><span class="p">,</span> <span class="n">octave</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">pitch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">note</span> <span class="o">=</span> <span class="n">pitch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">midi</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="n">octave</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">pitches</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">midi</span></div>



<div class="viewcode-block" id="midi_to_cde">
<a class="viewcode-back" href="../../api.html#djalgo.utils.midi_to_cde">[docs]</a>
<span class="k">def</span> <span class="nf">midi_to_cde</span><span class="p">(</span><span class="n">midi</span><span class="p">):</span>
    <span class="c1"># Mapping of MIDI numbers to note names</span>
    <span class="n">pitches</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;C#&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;D#&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;F#&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;G#&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;A#&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]</span>
    <span class="n">octave</span> <span class="o">=</span> <span class="n">midi</span> <span class="o">//</span> <span class="mi">12</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">midi</span> <span class="o">%</span> <span class="mi">12</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="n">pitches</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">octave</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pitch</span></div>


<div class="viewcode-block" id="no_overlap">
<a class="viewcode-back" href="../../api.html#djalgo.utils.no_overlap">[docs]</a>
<span class="k">def</span> <span class="nf">no_overlap</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="s1">&#39;offsets&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusts the offsets of the notes to prevent overlap.</span>

<span class="sd">    Args:</span>
<span class="sd">        notes (list): A list of tuples, where each tuple contains a note (pitch),</span>
<span class="sd">                      a duration (quarterLength), and an offset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: The list of notes with adjusted offsets or durations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">adjusted_notes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_offset</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
        <span class="n">adjusted_notes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pitch</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">current_offset</span><span class="p">))</span>
        <span class="n">current_offset</span> <span class="o">+=</span> <span class="n">duration</span>

    <span class="k">return</span> <span class="n">adjusted_notes</span></div>


<div class="viewcode-block" id="check_input">
<a class="viewcode-back" href="../../api.html#djalgo.utils.check_input">[docs]</a>
<span class="k">def</span> <span class="nf">check_input</span><span class="p">(</span><span class="n">input_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if the input is a list of simple elements or a list of tuples.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_list (list): The input to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: &#39;list&#39; if the input is a list of simple elements,</span>
<span class="sd">             &#39;list of tuples&#39; if the input is a list of tuples,</span>
<span class="sd">             &#39;unknown&#39; otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">input_list</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;list of tuples&#39;</span>
    <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">input_list</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;list&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;unknown&#39;</span></div>


<div class="viewcode-block" id="scale_list">
<a class="viewcode-back" href="../../api.html#djalgo.utils.scale_list">[docs]</a>
<span class="k">def</span> <span class="nf">scale_list</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">to_min</span><span class="p">,</span> <span class="n">to_max</span><span class="p">,</span> <span class="n">min_numbers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_numbers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scale a list of numbers so that its range is between min_value and max_value.</span>

<span class="sd">    Args:</span>
<span class="sd">        numbers (list): List of numbers to scale.</span>
<span class="sd">        min_value (float): Minimum value of the scaled list.</span>
<span class="sd">        max_value (float): Maximum value of the scaled list.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Scaled list of numbers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">min_numbers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">min_numbers</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_numbers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_numbers</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[(</span><span class="n">num</span> <span class="o">-</span> <span class="n">min_numbers</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">to_max</span> <span class="o">-</span> <span class="n">to_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_numbers</span> <span class="o">-</span> <span class="n">min_numbers</span><span class="p">)</span> <span class="o">+</span> <span class="n">to_min</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">]</span></div>


<div class="viewcode-block" id="offset_list_of_notes">
<a class="viewcode-back" href="../../api.html#djalgo.utils.offset_list_of_notes">[docs]</a>
<span class="k">def</span> <span class="nf">offset_list_of_notes</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">by</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Offset the notes in a list by a given amount.</span>

<span class="sd">    Args:</span>
<span class="sd">        list (list): List of notes to offset.</span>
<span class="sd">        by (float): Amount to offset the notes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List of notes with adjusted offsets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">by</span><span class="p">)</span> <span class="k">for</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">]</span></div>



<div class="viewcode-block" id="quantize_notes">
<a class="viewcode-back" href="../../api.html#djalgo.utils.quantize_notes">[docs]</a>
<span class="k">def</span> <span class="nf">quantize_notes</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">measure_length</span><span class="p">,</span> <span class="n">time_resolution</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quantize the durations and offsets of notes in musical phrases.</span>

<span class="sd">    Args:</span>
<span class="sd">        notes (list): List of musical phrases, where each phrase is a list of tuples (pitch, duration, offset).</span>
<span class="sd">        measure_length (float): The total duration of a measure, typically in quarter notes.</span>
<span class="sd">        time_resolution (float): The smallest time unit for quantization, typically in quarter notes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: The quantized musical phrases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">quantized_notes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
        <span class="n">pitch</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">note</span>
        <span class="n">quantized_offset</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">offset</span> <span class="o">/</span> <span class="n">time_resolution</span><span class="p">)</span> <span class="o">*</span> <span class="n">time_resolution</span>
        <span class="n">measure_end</span> <span class="o">=</span> <span class="p">((</span><span class="n">quantized_offset</span> <span class="o">//</span> <span class="n">measure_length</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">measure_length</span>
        <span class="n">quantized_duration</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="n">time_resolution</span><span class="p">)</span> <span class="o">*</span> <span class="n">time_resolution</span>
        <span class="n">quantized_duration</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">quantized_duration</span><span class="p">,</span> <span class="n">measure_end</span> <span class="o">-</span> <span class="n">quantized_offset</span><span class="p">)</span>
        <span class="n">quantized_notes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pitch</span><span class="p">,</span> <span class="n">quantized_duration</span><span class="p">,</span> <span class="n">quantized_offset</span><span class="p">))</span>
    <span class="n">quantized_notes</span> <span class="o">=</span> <span class="p">[</span><span class="n">note</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">quantized_notes</span> <span class="k">if</span> <span class="n">note</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># remove notes with zero duration</span>
    <span class="k">return</span> <span class="n">quantized_notes</span></div>



<div class="viewcode-block" id="find_closest_pitch_at_measure_start">
<a class="viewcode-back" href="../../api.html#djalgo.utils.find_closest_pitch_at_measure_start">[docs]</a>
<span class="k">def</span> <span class="nf">find_closest_pitch_at_measure_start</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">measure_length</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the closest pitch at the beginning of each measure.</span>

<span class="sd">    Args:</span>
<span class="sd">        notes (list of tuples): A list of tuples where each tuple is (pitch, duration, offset).</span>
<span class="sd">        measure_length (float): The length of a measure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of pitches, each representing the closest pitch at the start of a measure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sort the notes by offset to ensure they are in order</span>
    <span class="n">notes_sorted_by_offset</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1"># Find the maximum offset to determine how many measures we have</span>
    <span class="n">max_offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">num_measures</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_offset</span> <span class="o">//</span> <span class="n">measure_length</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">closest_pitches</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">measure_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_measures</span><span class="p">):</span>
        <span class="n">measure_start</span> <span class="o">=</span> <span class="n">measure_num</span> <span class="o">*</span> <span class="n">measure_length</span>
        <span class="n">closest_pitch</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">closest_distance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">notes_sorted_by_offset</span><span class="p">:</span>
            <span class="c1"># Calculate the distance from the start of the measure to the note&#39;s offset</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">measure_start</span> <span class="o">-</span> <span class="n">offset</span>

            <span class="c1"># If the note starts before the measure and is closer than any note we&#39;ve looked at before</span>
            <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">closest_distance</span><span class="p">:</span>
                <span class="n">closest_distance</span> <span class="o">=</span> <span class="n">distance</span>
                <span class="n">closest_pitch</span> <span class="o">=</span> <span class="n">pitch</span>

            <span class="c1"># If we&#39;ve passed the current measure start, we can break out of the loop</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="n">measure_start</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">closest_pitch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">closest_pitches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">closest_pitch</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">closest_pitches</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../01_getting-started.html">1. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_harmony.html">2. Harmonies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03_loops.html">3. Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_minimalism.html">4. Minimalism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../05_walks.html">5. Walks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../06_fractals.html">6. Fractals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../07_genetic.html">7. Genetic algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../08_ai.html">8. 🤖 Machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><div>
<br/>
<a href="https://www.buymeacoffee.com/essicolo">☕ Buy me a coffee</a>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Essi Parent.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>