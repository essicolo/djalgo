<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3. Loops &#8212; Djalgo 0.1-alpha documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script src="_static/documentation_options.js?v=737112c1"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Minimalism" href="04_minimalism.html" />
    <link rel="prev" title="2. Harmonies" href="02_harmony.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="3.-Loops">
<h1>3. Loops<a class="headerlink" href="#3.-Loops" title="Link to this heading">¶</a></h1>
<p>Let’s delve into a technique centred around numbers, but essentially visual, steering clear of mathematical functions. Multilevel rhythms in music and mathematics are about orchestrating beats, durations, and accents across various tiers or facets of a composition or sequence. These rhythmic patterns often manifest as polygons nestled within a circle, symbolizing the loop’s periodic nature. I’ve coined the term polyloops for these looping polygons (poly) to capture the essence of looping
multiple shapes. Imagine a radar plot, as depicted in the next figure, that emits a beep each time a rotating line intersects a point on the circle’s perimeter. This setup allows us to: (1) introduce any number of points, (2) layer multiple polygons, each associated with a distinct instrument, (3) create triggered notes with tailored pitches and durations, and (4) adjust the rotation’s velocity to our liking.</p>
<p><img alt="78c74e84a7c54f7db10a4a11244ffd77" src="_images/polyloops.svg" /></p>
<p>In Djalgo, we represent each polyloop as a track, i.e. a list of note tuples, each tuple being a note defined as (pitch, duration, offset). A first polyloop might cover the basic rhythmic pattern of a loop. A second, as another layer of rhythms, and a third that leans towards the melodic side. The latter polyloop could incorporate varying pitches, adding a melodic layer to our rhythmic foundation. By carefully selecting the timing, we can craft a composition that not only has rhythmic interest
but also melodic movement.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">djalgo</span> <span class="k">as</span> <span class="nn">dj</span>
</pre></div>
</div>
</div>
<p>The concept of pulses is fundamental to understanding the structuring of rhythms within a measure. These pulses act like the ticks of a metronome, providing a temporal grid to which musical events can be aligned. In the context of our polyloops, each pulse represents a potential moment for a note to be triggered, with a granularity of 0.25 beats. This granularity divides a measure, or period, of 4 beats into 16 discrete pulses, offering a precise framework for rhythm creation.</p>
<p>Given that each offset within a polyloop corresponds to a specific pulse and all such numbers are constrained to be less than the measure length, we have a clear and structured approach to rhythm design. This method ensures that all rhythmic events occur within the confines of a single measure, looping back at the end of each cycle.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">polyloop0</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="c1"># the decimal point is used to make sure the number is a float</span>
    <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">polyloop1</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">67</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">69</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">polyloop2</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">72</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">79</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">81</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">74</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">79</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">84</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">72</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">measure_length</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">pl1</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">Polyloop</span><span class="p">(</span>
    <span class="n">polyloops</span><span class="o">=</span><span class="p">[</span><span class="n">polyloop0</span><span class="p">,</span> <span class="n">polyloop1</span><span class="p">,</span> <span class="n">polyloop2</span><span class="p">],</span>
    <span class="n">measure_length</span><span class="o">=</span><span class="n">measure_length</span><span class="p">,</span>
    <span class="n">insert_rests</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>At the end of the previous block, a list of all the polyloops is inserted in the Djalgo <code class="docutils literal notranslate"><span class="pre">Polyloop</span></code> class, along with the lenght of a measure. The <code class="docutils literal notranslate"><span class="pre">Polyloop</span></code> object automatically insert rests as notes with a pitch of <code class="docutils literal notranslate"><span class="pre">None</span></code>, and has three components: <code class="docutils literal notranslate"><span class="pre">pl1.polyloops</span></code> is a list of all the polyloops of the object, <code class="docutils literal notranslate"><span class="pre">pl1.plot_polyloop</span></code> creates a visualization of the polyloops and <code class="docutils literal notranslate"><span class="pre">pl1.measure_lenght</span></code>carries the measure length, if we need it later on.</p>
<p>Visualizing polyloops in a radar plot is an excellent way to understand and appreciate the complexity and beauty of your rhythmic and melodic constructions, allowing to appreciate the structured arrangement of offsets, durations, and accents within the measure. This visualization can be particularly helpful for analyzing the interplay between different polyloops and for refining the composition by making adjustments based on the visual feedback.</p>
<p>To use the <code class="docutils literal notranslate"><span class="pre">plot_polyloops()</span></code> method, you need to provide it a <code class="docutils literal notranslate"><span class="pre">pulse</span></code> argument, which is granularity of the temporal grid within the measure, which has been set at 1/4 beats in our examples. The pulse defines the spacing of possible note triggers within the measure.</p>
<p>I had to write the plot to an image to render it properly on this website, but on your side, running just <code class="docutils literal notranslate"><span class="pre">pl1.plot_polyloops(pulse=1/4)</span></code> should display an interactive plot.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pl1</span><span class="o">.</span><span class="n">plot_polyloops</span><span class="p">(</span><span class="n">pulse</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="s2">&quot;_images/pl1.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><img alt="0b77803bf31546d58e0b54993accd07a" src="_images/pl1.png" /></p>
<p>The plot show the structure of the loop in terms of durations and offsets. The pitch information is purposely excluded to simplify the visualization and prevent the plot from becoming too cluttered. The polyloops are displayed starting from the innermost loop, featuring the shortest radius, progressing outward to the final loop according to the order of the list in the <code class="docutils literal notranslate"><span class="pre">polyloops</span></code> argument. Each loop’s shape is delineated by a polygon to represent its structure. For instance, polyloop 0, which
initiates four notes, forms a polygon that appears as a square. Since the four segments are equal, this loop is said to be <em>Euclidean</em>. The durations are depicted by arcs, with tiny radial marks denoting the start of the arc and its conclusion. Upon closer inspection, you might notice that some arcs appear darker than others. This indicates moments where one note sustains as the next begins. While this overlap is intentional, it’s worth noting that traditional western music notation sometimes
struggles to accurately represent such overlapping notes. We might correct that manually. I’d also like to make polyloop0 to be less Euclidean.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">polyloop1</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">67</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">69</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
    <span class="c1"># 0.5 instead of 1.0, to make sure the last note doesn&#39;t overlap</span>
    <span class="c1"># with the first note of the next measure</span>
    <span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">polyloop0</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="c1"># less Euclidean</span>
    <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># replace the pl object by the new one with corrected polyloop1</span>
<span class="n">pl1</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">Polyloop</span><span class="p">(</span>
    <span class="n">polyloops</span><span class="o">=</span><span class="p">[</span><span class="n">polyloop0</span><span class="p">,</span> <span class="n">polyloop1</span><span class="p">,</span> <span class="n">polyloop2</span><span class="p">],</span>
    <span class="n">measure_length</span><span class="o">=</span><span class="n">measure_length</span><span class="p">,</span>
    <span class="n">insert_rests</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>The last aspect of polyloops, as mentioned earlier, was its speed. We will define the tempo as a variable named <code class="docutils literal notranslate"><span class="pre">bpm</span></code>, for beats (or quarter lenghts) per minute. To construct the musical composition, we sequentially generate notes and integrate them into a musical stream. The conversion function takes care of converting the Djalgo format to Music21 objects.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">music21</span> <span class="k">as</span> <span class="nn">m21</span>
<span class="n">bpm</span><span class="o">=</span><span class="mi">120</span>
<span class="n">m21score</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">pl1</span><span class="o">.</span><span class="n">polyloops</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s1">&#39;music21&#39;</span><span class="p">)</span>
<span class="n">metronome</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">tempo</span><span class="o">.</span><span class="n">MetronomeMark</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">bpm</span><span class="p">)</span>
<span class="n">m21score</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">metronome</span><span class="p">)</span>
<span class="n">m21score</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03_loops_12_0.png" class="no-scaled-link" src="_images/03_loops_12_0.png" style="width: 697px; height: 255px;" />
</div>
</div>
<p>Once a loop is created, repetitions are usually desired. For this purpose, the <code class="docutils literal notranslate"><span class="pre">polyscore</span></code> object can be exported to MIDI, then imported in a DAW, in which you would either copy-paste the MIDI block, or extend it through the time direction with some loop widget toggled on. You could either do it in Python before the exportation. In the following code block, each polyloop is stacked one after the other, with an adjusted offset. There are multiple ways this operation could be done.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_measures</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">pl1_loop</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">polyloop</span> <span class="ow">in</span> <span class="n">pl1</span><span class="o">.</span><span class="n">polyloops</span><span class="p">:</span>
    <span class="n">repeated_polyloop</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_measures</span><span class="p">):</span>
        <span class="n">measure_offset</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">measure_length</span>
        <span class="n">offseted_polyloop</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">offset_list_of_notes</span><span class="p">(</span><span class="n">polyloop</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="n">measure_offset</span><span class="p">)</span>
        <span class="n">repeated_polyloop</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">offseted_polyloop</span><span class="p">)</span>
    <span class="n">pl1_loop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repeated_polyloop</span><span class="p">)</span>
<span class="n">pl1_loop</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">Polyloop</span><span class="p">(</span><span class="n">polyloops</span><span class="o">=</span><span class="n">pl1_loop</span><span class="p">,</span> <span class="n">measure_length</span><span class="o">=</span><span class="n">pl1</span><span class="o">.</span><span class="n">measure_length</span><span class="p">)</span>
<span class="n">pl1_score</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">pl1_loop</span><span class="o">.</span><span class="n">polyloops</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s1">&#39;music21&#39;</span><span class="p">)</span>
<span class="n">metronome</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">tempo</span><span class="o">.</span><span class="n">MetronomeMark</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">bpm</span><span class="p">)</span>
<span class="n">pl1_score</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">metronome</span><span class="p">)</span>
<span class="n">pl1_score</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03_loops_14_0.png" class="no-scaled-link" src="_images/03_loops_14_0.png" style="width: 732px; height: 635px;" />
</div>
</div>
<section id="Many-polyloops">
<h2>Many polyloops<a class="headerlink" href="#Many-polyloops" title="Link to this heading">¶</a></h2>
<p>You can generate as many polyloops as desired. Polyloops can me stacked horizontally (along time), or vertically (multiple instruments). Interestingly, vertically stacked polyloops have diffent lengths can create unpredictable patterns. In the following code block, a polyloop with a measure lenght of 6 is created.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">measure_length</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">pl2</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">Polyloop</span><span class="p">(</span>
    <span class="n">polyloops</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">95</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">89</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">84</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">67</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">69</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">4.25</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">72</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">4.75</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">measure_length</span><span class="o">=</span><span class="n">measure_length</span>
<span class="p">)</span>

<span class="n">pl2</span><span class="o">.</span><span class="n">plot_polyloops</span><span class="p">(</span><span class="n">pulse</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="s2">&quot;_images/pl2.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><img alt="ad78bc1e17f849e283731f27fd87f21c" src="_images/pl2.png" /></p>
<p>The following code block uses another approach for stacking loops. Instead of appending new notes to the Polyloop object as we did earlier, the stacking is done with Music21. Notice how the key signature and tempo are stacked horizontally in parts before measures are themselves stacking horizontally, and how parts are stacking vertically in a score. The first polyloop had a measure length of 4, and was repeated 6 times. The second has a measure length of 6, so it must be repeated 4 times to have
de same length.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_measures</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">pl2_loop</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">polyloop</span> <span class="ow">in</span> <span class="n">pl2</span><span class="o">.</span><span class="n">polyloops</span><span class="p">:</span>
    <span class="n">repeated_polyloop</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_measures</span><span class="p">):</span>
        <span class="n">measure_offset</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">measure_length</span>
        <span class="n">offseted_polyloop</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">offset_list_of_notes</span><span class="p">(</span><span class="n">polyloop</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="n">measure_offset</span><span class="p">)</span>
        <span class="n">repeated_polyloop</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">offseted_polyloop</span><span class="p">)</span>
    <span class="n">pl2_loop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repeated_polyloop</span><span class="p">)</span>
<span class="n">pl2_loop</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">loop</span><span class="o">.</span><span class="n">Polyloop</span><span class="p">(</span><span class="n">polyloops</span><span class="o">=</span><span class="n">pl2_loop</span><span class="p">,</span> <span class="n">measure_length</span><span class="o">=</span><span class="n">pl1</span><span class="o">.</span><span class="n">measure_length</span><span class="p">)</span>
<span class="n">pl2_score</span> <span class="o">=</span> <span class="n">dj</span><span class="o">.</span><span class="n">conversion</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">pl2_loop</span><span class="o">.</span><span class="n">polyloops</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s1">&#39;music21&#39;</span><span class="p">)</span>
<span class="n">metronome</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">tempo</span><span class="o">.</span><span class="n">MetronomeMark</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">bpm</span><span class="p">)</span>
<span class="n">pl2_score</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">metronome</span><span class="p">)</span>
<span class="n">pl2_score</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03_loops_19_0.png" class="no-scaled-link" src="_images/03_loops_19_0.png" style="width: 732px; height: 633px;" />
</div>
</div>
<p>In Music21, you can stack vertically (like stacking tracks) by inserting score at offset 0.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pl_score</span> <span class="o">=</span> <span class="n">m21</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">Score</span><span class="p">()</span>
<span class="n">pl_score</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pl1_score</span><span class="p">)</span>
<span class="n">pl_score</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pl2_score</span><span class="p">)</span>
<span class="n">pl_score</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s1">&#39;midi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div id="midiPlayerDiv3958"></div>
<link rel="stylesheet" href="https://cuthbertLab.github.io/music21j/css/m21.css">

<script
src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"
></script>

<script>
function midiPlayerDiv3958_play() {
    const rq = require.config({
        paths: {
            'music21': 'https://cuthbertLab.github.io/music21j/releases/music21.debug',
        }
    });
    rq(['music21'], function(music21) {
        mp = new music21.miditools.MidiPlayer();
        mp.addPlayer("#midiPlayerDiv3958");
        mp.base64Load("data:audio/midi;base64,TVRoZAAAAAYAAQACJ2BNVHJrAAAAFAD/UQMHoSAA/1gEBAIYCM5g/y8ATVRyawAABa4A/wMAAOAAQM5gkDBaAJBDWgCQSFoAkCRaAJA8WpNYgEgAAIA8AACQPlqTWIA+AACQT1oAkEBak1iATwAAgEAAAJBRWgCQQVqTWIAwAACAQwAAgCQAAIBRAACAQQAAkEpaAJApWgCQYFoAkENak1iAYACTWIBKAACAKQAAkDJak1iQX1qTWIAyAACQPFoAkDxaAJAwWpNYgDwAAJBPWpNYgDwAAIAwAACATwAAkEVaAJBUWpNYgF8Ak1iAQwAAgFQAAJA0WgCQSFoAkChaAJBZWgCQRVqnMIBFAACQPlqnMIA0AACASAAAgCgAAIBFAACAPgAAkDBaAJBDWgCQSFoAkCtaAJA8WpNYgEgAAIA8AACQPlqTWIArAACAPgAAkE9aAJBAWpNYgE8AAIBAAACQUVoAkEhak1iAWQAAgDAAAIBDAACAUQAAgEgAAJBKWgCQMFoAkFRapzCASgAAkDJapzCAMAAAgFQAAIAyAACQPFoAkDxaAJAkWgCQPFqTWIA8AACAPAAAkE9aAJA+WpNYgDwAAIBPAACAPgAAkEVaAJBUWgCQQFqTWIBAAACQQVqTWIAkAACAVAAAgEEAAJA0WgCQSFoAkClaAJBgWgCQQ1qTWIBgAJNYgEUAAIApAACQPlqTWJBfWpNYgDQAAIBIAACAPgAAkDBaAJBDWgCQSFoAkDBak1iASACTWIAwAACQT1qTWIBfAACATwAAkFFak1iAQwAAgDAAAIBDAACAUQAAkEpaAJAoWgCQWVoAkEVapzCASgAAkDJapzCAKAAAgEUAAIAyAACQPFoAkDxaAJArWgCQPFqTWIA8AACAPAAAkE9aAJA+WpNYgDwAAIArAACATwAAgD4AAJBFWgCQVFoAkEBak1iAQAAAkEhak1iAWQAAgFQAAIBIAACQNFoAkEhaAJAwWgCQVFqnMIBFAACQPlqnMIA0AACASAAAgDAAAIBUAACAPgAAkDBaAJBDWgCQSFoAkCRaAJA8WpNYgEgAAIA8AACQPlqTWIA+AACQT1oAkEBak1iATwAAgEAAAJBRWgCQQVqTWIAwAACAQwAAgCQAAIBRAACAQQAAkEpaAJApWgCQYFoAkENak1iAYACTWIBKAACAKQAAkDJak1iQX1qTWIAyAACQPFoAkDxaAJAwWpNYgDwAAJBPWpNYgDwAAIAwAACATwAAkEVaAJBUWpNYgF8Ak1iAQwAAgFQAAJA0WgCQSFoAkChaAJBZWgCQRVqnMIBFAACQPlqnMIA0AACASAAAgCgAAIBFAACAPgAAkDBaAJBDWgCQSFoAkCtaAJA8WpNYgEgAAIA8AACQPlqTWIArAACAPgAAkE9aAJBAWpNYgE8AAIBAAACQUVoAkEhak1iAWQAAgDAAAIBDAACAUQAAgEgAAJBKWgCQMFoAkFRapzCASgAAkDJapzCAMAAAgFQAAIAyAACQPFoAkDxaAJAkWgCQPFqTWIA8AACAPAAAkE9aAJA+WpNYgDwAAIBPAACAPgAAkEVaAJBUWgCQQFqTWIBAAACQQVqTWIAkAACAVAAAgEEAAJA0WgCQSFoAkClaAJBgWgCQQ1qTWIBgAJNYgEUAAIApAACQPlqTWJBfWpNYgDQAAIBIAACAPgAAkDBaAJBDWgCQSFoAkDBak1iASACTWIAwAACQT1qTWIBfAACATwAAkFFak1iAQwAAgDAAAIBDAACAUQAAkEpaAJAoWgCQWVoAkEVapzCASgAAkDJapzCAKAAAgEUAAIAyAACQPFoAkDxaAJArWgCQPFqTWIA8AACAPAAAkE9aAJA+WpNYgDwAAIArAACATwAAgD4AAJBFWgCQVFoAkEBak1iAQAAAkEhak1iAWQAAgFQAAIBIAACQNFoAkEhaAJAwWgCQVFqnMIBFAACQPlqnMIA0AACASAAAgDAAAIBUAACAPgDOYP8vAA==");
    });
}
if (typeof require === 'undefined') {
    setTimeout(midiPlayerDiv3958_play, 2000);
} else {
    midiPlayerDiv3958_play();
}
</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pl_score</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;midi&#39;</span><span class="p">,</span> <span class="s1">&#39;_output/polyloop.mid&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;_output/polyloop.mid&#39;
</pre></div></div>
</div>
<section id="Signal-analysis">
<h3>Signal analysis<a class="headerlink" href="#Signal-analysis" title="Link to this heading">¶</a></h3>
<p>Signal analysis will reveal its full potential when introducing genetic algorithms in the <a class="reference external" href="api.html#djalgo.genetic.Darwin">Darwin</a> class. But since our focus is loops, we will use the <a class="reference external" href="api.html#djalgo.analysis.Index">Index</a> class to quantify some attributes of our composition.</p>
</section>
</section>
<section id="Wellformness-as-loop-inequalities">
<h2>Wellformness as loop inequalities<a class="headerlink" href="#Wellformness-as-loop-inequalities" title="Link to this heading">¶</a></h2>
<p>In music theory, well-formness refers to the coherence and structural integrity of musical compositions according to specific compositional principles and conventions. It encompasses how elements such as melody, harmony, rhythm, and form are organized and developed in a way that is considered orderly, logical, and aesthetically pleasing within the context of the musical style or genre being analyzed. Well-formedness is not a singular, quantifiable attribute but rather a qualitative assessment of
music’s adherence to established musical norms and patterns, which can vary across different cultural and historical contexts. Well-formness can nonetheless be assessed quantitatively.</p>
<p>The Gini index is a measure of statistical dispersion intended to represent the income or wealth distribution, but can be adapted to measure the diversity or inequality of any set of quantitative values, including offsets, pitches and durations of musical notes. The Gini index ranges from 0 o 1, where 0 signifies perfect equality (for instance, all note durations are the same) and 1 signifies maximal inequality (for instance, all durations are the same). The equation of the Gini coefficient is:</p>
<div class="math notranslate nohighlight">
\[G = \frac{1}{n} \left( n + 1 - 2 \left( \frac{\sum_{i=1}^{n} (n + 1 - i) \cdot x_i \cdot w_i}{\sum_{i=1}^{n} x_i \cdot w_i} \right) \right)\]</div>
<p>where: - <span class="math notranslate nohighlight">\(n\)</span> is the number of observations (notes in this context), - <span class="math notranslate nohighlight">\(x_i\)</span> is the value of the <span class="math notranslate nohighlight">\(i^{th}\)</span> observation sorted in non-decreasing order (the attribute of each note), - <span class="math notranslate nohighlight">\(w_i\)</span> is the weight associated with the <span class="math notranslate nohighlight">\(i^{th}\)</span> observation, - and the sum <span class="math notranslate nohighlight">\(\sum_{i=1}^{n} x_i \cdot w_i\)</span> is the total weighted sum of all observations.</p>
<p>An implementation of this equation can be found in the <a class="reference external" href="api.html#djalgo.analysis.Index">Index</a> class. Without weights,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unequal: &quot;</span><span class="p">,</span> <span class="n">dj</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">gini</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Equal:   &quot;</span><span class="p">,</span> <span class="n">dj</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">gini</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Unequal:  0.75
Equal:    0.0
</pre></div></div>
</div>
<p>While economic inequalities are sources of problems in a society, unequal music can create less predictable forms.</p>
<ul class="simple">
<li><p><em>Offsets</em>: a moderate Gini index might indicate a well-balanced rhythmic structure, neither too monotonous (very low Gini) nor too erratic (very high Gini).</p></li>
<li><p><em>Pitches</em>: a lower Gini index could suggest thematic unity or motif repetition, whereas a higher value indicates more changes in pitches.</p></li>
<li><p><em>Durations</em>: less diversity might indicate rhythmic coherence, enhancing well-formedness.</p></li>
</ul>
<p>We can compute a Gini index for each polyloop, and for all of them, on offsets, pitches and durations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gini_pitch</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">gini_duration</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">gini_offset</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">polyloop</span> <span class="ow">in</span> <span class="n">pl1</span><span class="o">.</span><span class="n">polyloops</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">note</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">polyloop</span> <span class="k">if</span> <span class="n">note</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">note</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">polyloop</span> <span class="k">if</span> <span class="n">note</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">o</span> <span class="o">=</span> <span class="p">[</span><span class="n">note</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">polyloop</span> <span class="k">if</span> <span class="n">note</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">gini_pitch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">gini</span><span class="p">())</span>
    <span class="n">gini_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">gini</span><span class="p">())</span>
    <span class="n">gini_offset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="n">gini</span><span class="p">())</span>


<span class="n">gini_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Pitch&#39;</span><span class="p">:</span> <span class="n">gini_pitch</span><span class="p">,</span>
    <span class="s1">&#39;Duration&#39;</span><span class="p">:</span> <span class="n">gini_duration</span><span class="p">,</span>
    <span class="s1">&#39;Offset&#39;</span><span class="p">:</span> <span class="n">gini_offset</span>
<span class="p">}</span>

<span class="n">gini_data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Pitch&#39;: [0.0452380952380953, 0.023569023569023573, 0.04970881863560739],
 &#39;Duration&#39;: [0.16666666666666652, 0.1875, 0.26249999999999996],
 &#39;Offset&#39;: [0.33333333333333326, 0.4285714285714286, 0.4054545454545453]}
</pre></div></div>
</div>
<p>Djalgo just do the analysis for lists of numbers. We extract the indices, then plot them with Plotly, a ploting library used under the hood to plot polyloops. Plotly should have been installed when you installed Djalgo. The longer the bar, the wilder polyloops are going to be.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="n">bars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">polyloop</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pl1</span><span class="o">.</span><span class="n">polyloops</span><span class="p">):</span>
    <span class="n">bars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">gini_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">gini_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">gini_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
        <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Polyloop </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">bars</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Gini Coefficients&#39;</span><span class="p">,</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Gini Coefficient&#39;</span><span class="p">,</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Note Attribute&#39;</span><span class="p">,</span>
    <span class="n">barmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="s2">&quot;_images/gini.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><img alt="a0c8ed3abc814e5590a90197b3a301cf" src="_images/gini.png" /></p>
</section>
<section id="Balance">
<h2>Balance<a class="headerlink" href="#Balance" title="Link to this heading">¶</a></h2>
<p>Analyzing the balance within loops offers insights into the structural and aesthetic qualities of a piece, revealing how composers craft complex yet coherent musical landscapes. A balance index would quantify how symmetrically distributed the offsets or pitches are across a rhythmic cycle. A polyloop or a set of polyloops exhibit perfect balance if the weighted average of the positions equals half the sum of all durations or weights, which can also be interpreted as the center of mass of the
rhythm being centrally located. The mathematical condition for perfect balance is:</p>
<div class="math notranslate nohighlight">
\[\frac{\sum_{i=1}^{N} P_i \cdot W_i}{\sum_{i=1}^{N} W_i} = \frac{1}{2} \cdot \text{Total Length of the Cycle}\]</div>
<p>where - <span class="math notranslate nohighlight">\(P_i\)</span>: the position of the <span class="math notranslate nohighlight">\(i^{th}\)</span> beat or accented note in the cycle. - <span class="math notranslate nohighlight">\(W_i\)</span>: the duration or weight of the <span class="math notranslate nohighlight">\(i^{th}\)</span> beat or accented note. - <span class="math notranslate nohighlight">\(N\)</span>: the total number of beats or accented notes. - <span class="math notranslate nohighlight">\(\text{Total Length of the Cycle}\)</span> is the sum of all durations or the position of the last beat plus its duration if the rhythm is considered continuous.</p>
<p>The notion of durational balance makes little sense. Durations contribute to the overall musical balance in a broader sense, such as in form and structure, and should be used as weights (<span class="math notranslate nohighlight">\(W_i\)</span>) to assess rhythmic ans pitch balance.</p>
<ul class="simple">
<li><p><em>Rhythmic balance</em> pertains to the symmetrical distribution of offsets across a cycle, weighted by durations. A rhythm exhibits perfect balance when its “center of mass” — the weighted average position of all beats, considering their strengths or durations — aligns with the midpoint of its cycle. This balance contributes to a rhythm’s perceived stability and coherence.</p></li>
<li><p><em>Pitch balance</em> involves the distribution of musical pitches or harmonic functions throughout a composition. Pitch balance can also be weighed by the durations, to mgnify the importance of longer notes. In polyphonic textures, achieving pitch balance might mean evenly distributing high and low pitches or ensuring that harmonic tension and resolution are symmetrically placed, contributing to the overall harmonic structure’s equilibrium.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">balance_pitch</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#balance_duration = []</span>
<span class="n">balance_offset</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">polyloop</span> <span class="ow">in</span> <span class="n">pl1</span><span class="o">.</span><span class="n">polyloops</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">note</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">polyloop</span> <span class="k">if</span> <span class="n">note</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">note</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">polyloop</span> <span class="k">if</span> <span class="n">note</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">o</span> <span class="o">=</span> <span class="p">[</span><span class="n">note</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">polyloop</span> <span class="k">if</span> <span class="n">note</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">balance_pitch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">gini</span><span class="p">())</span>
    <span class="n">balance_offset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">gini</span><span class="p">())</span>

<span class="n">balance_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Pitch&#39;</span><span class="p">:</span> <span class="n">balance_pitch</span><span class="p">,</span>
    <span class="s1">&#39;Offset&#39;</span><span class="p">:</span> <span class="n">balance_offset</span>
<span class="p">}</span>

<span class="n">bars</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">polyloop</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pl1</span><span class="o">.</span><span class="n">polyloops</span><span class="p">):</span>
    <span class="n">bars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">balance_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">balance_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">balance_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
        <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Polyloop </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">bars</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Balance Coefficients&#39;</span><span class="p">,</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Balance Coefficient&#39;</span><span class="p">,</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Note Attribute&#39;</span><span class="p">,</span>
    <span class="n">barmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="s2">&quot;_images/balance.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><img alt="43181285bfd24f93a91c176a35cc26c1" src="_images/balance.png" /></p>
<p>When designing polyloops, lower levels (the first ones) are characterized by lower pitches, with darker (warmer) timbres (which are richer in low pitches) and more regular. Going higher is level (last polyloops), pitches become higher, timbres become brighter, and beats become less well-formed.</p>
<p>The design helpers are not made to reach equality and balance. They are made to reach a desired approximation for indices. As a composer, you may desire to have imbalance and inequality, for wilder music, but balance and equality for more predictable parts.</p>
<p>↳ <a class="reference external" href="04_minimalism.html">Minimalism</a></p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_getting-started.html">1. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_harmony.html">2. Harmonies</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3. Loops</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_minimalism.html">4. Minimalism</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_walks.html">5. Walks</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_fractals.html">6. Fractals</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_genetic.html">7. Genetic algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_ai.html">8. 🤖 Machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
</ul>

<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><div>
<br/>
<a href="https://www.buymeacoffee.com/essicolo">☕ Buy me a coffee</a>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Essi Parent.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/03_loops.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>